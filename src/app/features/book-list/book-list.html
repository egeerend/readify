<div class="book-list-container">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">Our Book Collection</h1>
    <p class="page-subtitle">Discover amazing books from our curated collection</p>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="row">
      <!-- Search -->
      <div class="col-md-5">
        <div class="search-box">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            class="form-control search-input" 
            placeholder="Search books, authors, or categories..."
            [(ngModel)]="searchQuery"
            (input)="onSearchChange()"
          >
        </div>
      </div>

      <!-- Sort Options -->
      <div class="col-md-4">
        <select class="form-select" [(ngModel)]="sortBy" (change)="onSortChange()">
          <option value="title">Sort by Title</option>
          <option value="author">Sort by Author</option>
          <option value="price">Sort by Price</option>
          <option value="rating">Sort by Rating</option>
          <option value="publishedDate">Sort by Date</option>
        </select>
      </div>

      <!-- Sort Order -->
      <div class="col-md-3">
        <button class="btn btn-outline-secondary w-100" (click)="toggleSortOrder()">
          <i class="fas" [class.fa-sort-up]="sortOrder === 'asc'" [class.fa-sort-down]="sortOrder === 'desc'"></i>
          {{ sortOrder === 'asc' ? 'A-Z' : 'Z-A' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Category Carousel -->
  <div class="category-section">
    <h3 class="category-title">
      <i class="fas fa-tags me-2"></i>
      Browse by Category
    </h3>
    
    <div class="category-carousel">
      <button 
        class="carousel-arrow carousel-arrow-left" 
        (click)="scrollCategoriesLeft()"
        [disabled]="categoryScrollPosition <= 0"
      >
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <div class="category-carousel-container">
        <div class="category-items">
          <button 
            class="category-item"
            [class.active]="selectedCategory === 'all'"
            (click)="selectCategory('all')"
          >
            <i class="fas fa-th-large"></i>
            <span>All Categories</span>
          </button>
          
          <button 
            *ngFor="let category of categories" 
            class="category-item"
            [class.active]="selectedCategory === category"
            (click)="selectCategory(category)"
          >
            <i class="fas fa-book"></i>
            <span>{{ category }}</span>
          </button>
        </div>
      </div>
      
      <button 
        class="carousel-arrow carousel-arrow-right" 
        (click)="scrollCategoriesRight()"
      >
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Results Info -->
  <div class="results-info" *ngIf="!isLoading">
    <p class="text-muted">
      Showing {{ filteredBooks.length }} of {{ books.length }} books
      <span *ngIf="selectedCategory !== 'all'"> in {{ selectedCategory }}</span>
      <span *ngIf="searchQuery"> matching "{{ searchQuery }}"</span>
    </p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading books...</p>
  </div>

  <!-- Books Grid -->
  <div *ngIf="!isLoading && filteredBooks.length > 0" class="books-grid">
    <div class="row">
      <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4" *ngFor="let book of filteredBooks">
        <div class="book-card">
          <!-- Book Cover -->
          <div class="book-cover-container">
            <img 
              [src]="book.coverImage" 
              [alt]="book.title"
              class="book-cover"
              (error)="onImageError($event)"
            >
            <div class="book-overlay">
              <div class="overlay-actions">
                <button class="btn btn-primary btn-sm" [routerLink]="['/books', book.id]">
                  <i class="fas fa-eye"></i> View Details
                </button>
              </div>
            </div>
          </div>

          <!-- Book Info -->
          <div class="book-info">
            <h5 class="book-title" [title]="book.title">{{ book.title }}</h5>
            <p class="book-author">
              <i class="fas fa-user me-1"></i>
              {{ book.author }}
            </p>

            <!-- Book Metadata -->
            <div class="book-metadata">
              <div class="metadata-row" *ngIf="book.publisher">
                <i class="fas fa-building me-1"></i>
                <small>{{ book.publisher }}</small>
              </div>
              <div class="metadata-row" *ngIf="book.publishedDate">
                <i class="fas fa-calendar me-1"></i>
                <small>{{ getPublishedYear(book.publishedDate) }}</small>
              </div>
              <div class="metadata-row" *ngIf="book.pageCount">
                <i class="fas fa-file-alt me-1"></i>
                <small>{{ book.pageCount }} pages</small>
              </div>
              <div class="metadata-row" *ngIf="book.isbn">
                <i class="fas fa-barcode me-1"></i>
                <small>{{ book.isbn }}</small>
              </div>
            </div>

            <!-- Category -->
            <div class="book-category">
              <span class="badge bg-light text-dark">{{ book.category }}</span>
            </div>

            <!-- Description -->
            <p class="book-description">{{ truncateDescription(book.description) }}</p>

            <!-- Rating -->
            <div class="book-rating" *ngIf="book.rating > 0">
              <div class="stars">
                <i 
                  *ngFor="let star of getStarsArray(book.rating)" 
                  class="fas fa-star"
                  [class.text-warning]="star <= book.rating"
                  [class.text-muted]="star > book.rating"
                ></i>
              </div>
              <small class="rating-text">
                {{ book.rating }}/5
                <span *ngIf="book.reviewCount > 0">({{ book.reviewCount }})</span>
              </small>
            </div>

            <!-- Price and Actions -->
            <div class="book-footer">
              <div class="book-price">
                <span class="current-price">{{ formatPrice(book.price) }}</span>
                <span *ngIf="book.originalPrice && book.originalPrice > book.price" class="original-price">
                  {{ formatPrice(book.originalPrice) }}
                </span>
              </div>
              
              <div class="book-actions">
                <button 
                  class="btn btn-primary btn-sm"
                  (click)="addToCart(book, $event)"
                  [disabled]="book.id && isInCart(book.id)"
                  [class.btn-success]="book.id && isInCart(book.id)"
                >
                  <i class="fas" [class.fa-shopping-cart]="!book.id || !isInCart(book.id)" [class.fa-check]="book.id && isInCart(book.id)"></i>
                  {{ (book.id && isInCart(book.id)) ? 'In Cart (' + getBookQuantity(book.id) + ')' : 'Add to Cart' }}
                </button>
              </div>
            </div>

            <!-- Book Status Badges -->
            <div class="book-badges">
              <span *ngIf="book.isFeatured" class="badge bg-warning text-dark">Featured</span>
              <span *ngIf="book.isBestseller" class="badge bg-success">Bestseller</span>
              <span *ngIf="book.isNew" class="badge bg-info">New</span>
              <span *ngIf="(book.stock || 0) < 5" class="badge bg-danger">Low Stock</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results -->
  <div *ngIf="!isLoading && filteredBooks.length === 0" class="no-results text-center py-5">
    <i class="fas fa-search fa-3x text-muted mb-3"></i>
    <h4>No books found</h4>
    <p class="text-muted">
      <span *ngIf="searchQuery">No books match your search for "{{ searchQuery }}".</span>
      <span *ngIf="!searchQuery && selectedCategory !== 'all'">No books found in the {{ selectedCategory }} category.</span>
      <span *ngIf="!searchQuery && selectedCategory === 'all'">No books available at the moment.</span>
    </p>
    <button *ngIf="searchQuery || selectedCategory !== 'all'" class="btn btn-primary" (click)="searchQuery = ''; selectedCategory = 'all'; applyFilters()">
      <i class="fas fa-times me-2"></i>Clear Filters
    </button>
  </div>
</div>
